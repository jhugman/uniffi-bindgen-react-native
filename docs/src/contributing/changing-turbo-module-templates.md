# Adding or changing turbo-module templates

In addition to generating the bindings between Hermes and Rust, `uniffi-bindgen-react-native` generates the files needed to run this as a turbo-module. The list of files are [documented elsewhere in this book](../reference/turbo-module-files.md).

Templates are written for [Rinja templating library](https://rinja.readthedocs.io/en/stable/template_syntax.html).

Changing the templates for these files is relatively simple. [This PR is a good example](https://github.com/jhugman/uniffi-bindgen-react-native/pull/112) of adding a file.

- Template files are in the [`codegen/templates` directory][codegen/templates].
- Template configuration are in [`codegen/mod.rs`][codegen/mod.rs] file.

[codegen/mod.rs]: https://github.com/jhugman/uniffi-bindgen-react-native/blob/main/crates/ubrn_cli/src/codegen/mod.rs
[codegen/templates]: https://github.com/jhugman/uniffi-bindgen-react-native/blob/main/crates/ubrn_cli/src/codegen/templates

### Adding a new template

1. Add new template to the [`codegen/templates` directory][codegen/templates].
1. Add a new `RenderedFile` struct, which specifies the template, and its path to [the `files` module](https://github.com/jhugman/uniffi-bindgen-react-native/blob/e7f85c616bf6985070081ec47f0b2b268890cc7d/crates/ubrn_cli/src/codegen/mod.rs#L141-L298) in [`codegen/mod.rs`][codegen/mod.rs].
1. Add an entry to [the list of generated files in this book](../reference/turbo-module-files.md).

The [template context](https://github.com/jhugman/uniffi-bindgen-react-native/blob/e7f85c616bf6985070081ec47f0b2b268890cc7d/crates/ubrn_cli/src/codegen/mod.rs#L55-L59) will have quite a lot of useful information data-structures about the project; the most prominent:

- [`ModuleMetadata`](https://github.com/jhugman/uniffi-bindgen-react-native/blob/main/crates/ubrn_bindgen/src/bindings/metadata.rs), which is generated from the `lib.a` file from the uniffi contents of the Rust library.
- [`ProjectConfig`](https://github.com/jhugman/uniffi-bindgen-react-native/blob/main/crates/ubrn_cli/src/config/mod.rs) which is the in-memory representation of the [YAML configuration file](../reference/config-yaml.md).
- [`CrateMetadata`](https://github.com/jhugman/uniffi-bindgen-react-native/blob/main/crates/ubrn_common/src/rust_crate.rs) which is data about the crate derived from `cargo metadata`.

## Testing changes

The `./scripts/test-turbo-modules.sh` script runs a suite of tests, simulating the steps in the [Getting Started tutorial](../guides/getting-started.md):

- do the names of the ubrn generated files match up with the files builder-bob generated files?
- do generated identifiers in the ubrn generated files match up with those generated by builder-bob?
- does an Android app compile
- does an iOS app compile

```admonish title="Help wanted"
This does not yet run continuous integration.
```

If you want to test a particular configuration, you can use the command with a series of options:

```sh
Usage: ./scripts/test-turbo-modules.sh [options] [PROJECT_DIR]

Options:
  -A, --android                      Build for Android.
  -I, --ios                          Build for iOS.
  -C, --ubrn-config                  Use a ubrn config file.
  -T, --app-tsx                      Use a App.tsx file.

  -s, --slug PROJECT_SLUG            Specify the project slug (default: my-test-library).
  -i, --ios-name IOS_NAME            Specify the iOS project name (default: MyTestLibrary).

  -u, --builder-bob-version VERSION  Specify the version of builder-bob to use (default: latest).
  -k, --keep-directory-on-exit       Keep the PROJECT_DIR directory even if an error does not occur.
  -f, --force-new-directory          If PROJECT_DIR directory exist, remove it first.
  -h, --help                         Display this help message.

Arguments:
  PROJECT_DIR                        Specify the root directory for the project (default: my-test-library).
```

For example, to test if a configuration builds then runs:

```sh
fixtures=./integration/fixtures/turbo-module-testing
directory=/tmp/my-test-library
./scripts/test-turbo-modules.sh \
    --ubrn-config $fixtures/ubrn.config.yaml \
    --app-tsx $fixtures/App.tsx \
    --ios \
    --android \
    --keep-directory-on-exit \
    --force-new-directory \
    "$directory"

cd "$directory"
yarn example start
```
